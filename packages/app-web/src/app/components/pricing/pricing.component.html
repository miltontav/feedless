@if (!hideServiceFlavor()) {
  <div>
    <ion-segment
      [formControl]="productFlavorFc"
      mode="ios"
      style="max-width: 400px; height: 50px"
    >
      <ion-segment-button [value]="productFlavorSelf">
        <ion-label>Self-Hosting</ion-label>
      </ion-segment-button>
      <ion-segment-button [value]="productFlavorCloud">
        <ion-label>Cloud</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>
}

<div class="ion-padding-top">
  @if (productFlavorFc.value === productFlavorSelf) {
    <div>
      <ion-segment
        [formControl]="targetGroupFc"
        mode="ios"
        style="max-width: 800px; height: 50px"
      >
        <ion-segment-button [value]="targetGroupOrganization">
          <ion-label
            ><span class="ion-hide-md-down">For</span> Organizations
          </ion-label>
        </ion-segment-button>
        <ion-segment-button [value]="targetGroupIndividual">
          <ion-label
            ><span class="ion-hide-md-down">For</span> Individuals
          </ion-label>
        </ion-segment-button>
        <ion-segment-button [value]="targetGroupOther">
          <ion-label>Discounts</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>
  }

  @if (productFlavorFc.value === productFlavorCloud) {
    <ion-segment
      mode="ios"
      appDev
      [formControl]="paymentIntervalFc"
      style="max-width: 300px; height: 50px"
    >
      <ion-segment-button [value]="paymentIntervalMonthly">
        <ion-label>Monthly</ion-label>
      </ion-segment-button>
      <ion-segment-button [value]="paymentIntervalYearly">
        <ion-label>Yearly</ion-label>
      </ion-segment-button>
    </ion-segment>
  }

  <div class="plans ion-margin-top">
    @if (productFlavorFc.value === productFlavorCloud) {}
    @if (productFlavorFc.value !== productFlavorCloud) {
      @if (targetGroupFc.value === targetGroupIndividual) {
        <p>
          Hobbyists, professionals, or casual users who seek to enhance their
          personal experience or skills.
        </p>
      }
      @if (targetGroupFc.value === targetGroupOrganization) {
        <p>
          Commercial enterprises, Non-Profit Organizations, Educational
          Institutions and Governmental Bodies who use the product as part of
          their activities. Reach out to me!
        </p>
      }
      @if (targetGroupFc.value === targetGroupOther) {
        <p>
          I am happy to give you discounts if you give me a good reason like being a student, using it in an open source project, etc.
        </p>
      }
    }

    @if (targetGroupFc.value !== targetGroupOther) {
      <div class="offers">
        @for (
          product of filteredProducts();
          track product.id;
          let index = $index
        ) {
          <div class="plan">
            <h3>{{ product.name }}</h3>
            <p>{{ product.description }}</p>
            <div style="flex: 1">
              @for (price of filteredPrices(product.prices); track price.id; let priceIndex = $index) {
                <ion-row>
                  <ion-col size="6" style="align-content: center">
                    <ion-text>{{ price.description }}</ion-text>
                  </ion-col>
                  <ion-col class="ion-text-right" size="6">
                    @if(priceIndex > 0) {
                      <h2 class="discount-tag" title="Discount">
                        <ion-text color="success">-{{ getDiscount(product, price) }}%</ion-text>
                      </h2>
                    }
                    <h1 style="display: inline-block">${{ formatPrice(price.price) }}</h1>
                  </ion-col>
                </ion-row>
              }
            </div>
            <div class="features">
              @for (
                featureGroup of product.stringifiedFeatureGroups;
                track featureGroup.groupLabel
              ) {
                @if (featureGroup.features.length > 0) {
                  <div class="feature__group">
                    {{ featureGroup.groupLabel }}
                  </div>
                  @for (feature of featureGroup.features; track feature) {
                    <app-feature [feature]="feature"></app-feature>
                  }
                }
              }
            </div>
            <div class="plan__action ion-margin-top">
              <div>
                @if (hasSubscribed(product)) {
                  @if (index === 0) {
                    <ion-button
                      color="medium"
                      [disabled]="true"
                      expand="full"
                    >
                      Enabled
                    </ion-button>
                  } @else {
                    <ion-button
                      (click)="cancelSubscription(product)"
                      color="danger"
                      expand="full"
                    >
                      Cancel Subscription
                    </ion-button>
                  }
                } @else {
                  <ion-button
                    (click)="buySubscription(product)"
                    color="primary"
                    expand="full"
                  >
                    {{ getProductActionLabel(product) }}
                  </ion-button>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
